"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.methods = void 0;
// src/scene.ts
const cc_1 = require("cc");
exports.methods = {
    /** 获取选中节点的所有标记子节点信息 */
    getSelectionNodes() {
        // 1. 获取选中的 UUID
        const uuids = Editor.Selection.getSelected('node');
        if (!uuids || uuids.length === 0) {
            return null;
        }
        const targetUuid = uuids[0];
        // 2. 终极兼容方案：从当前运行的 director 场景递归查找
        // 无论是在 Prefab 模式还是普通场景模式，编辑器都会把节点挂在当前 Scene 下
        const currentScene = cc_1.director.getScene();
        if (!currentScene) {
            console.error("【UI生成器】无法获取当前场景根节点");
            return null;
        }
        // 定义递归查找函数
        const findNodeByUuid = (root, uuid) => {
            if (root.uuid === uuid)
                return root;
            const children = root.children;
            for (let i = 0; i < children.length; i++) {
                const result = findNodeByUuid(children[i], uuid);
                if (result)
                    return result;
            }
            return null;
        };
        // 执行查找
        let rootNode = findNodeByUuid(currentScene, targetUuid);
        // 如果找不到，尝试 3.8.x 特有的 cce 获取方式（作为备选）
        if (!rootNode) {
            // @ts-ignore
            if (typeof cce !== 'undefined' && cce.Node && cce.Node.get) {
                // @ts-ignore
                rootNode = cce.Node.get(targetUuid);
            }
        }
        if (!rootNode) {
            console.error("【UI生成器】找不到 UUID 对应的节点: " + targetUuid);
            return null;
        }
        const nodeInfos = [];
        const prefixMap = {
            '_btn': 'Button',
            '_lbl': 'Label',
            '_spr': 'Sprite',
            '_node': 'Node',
            '_eb': 'EditBox'
        };
        // 3. 递归遍历选中的根节点，查找标记子节点
        const walk = (node) => {
            if (!node || !node.children)
                return;
            node.children.forEach((child) => {
                let isMatch = false;
                for (const prefix in prefixMap) {
                    if (child.name.startsWith(prefix)) {
                        nodeInfos.push({
                            name: child.name,
                            // @ts-ignore
                            type: prefixMap[prefix],
                            path: getNodePath(rootNode, child)
                        });
                        isMatch = true;
                        break;
                    }
                }
                // 递归继续查找子节点
                walk(child);
            });
        };
        walk(rootNode);
        return { className: rootNode.name, nodes: nodeInfos };
    }
};
/** 计算节点相对于根节点的路径 */
function getNodePath(root, target) {
    if (root === target)
        return "";
    let path = target.name;
    let curr = target.parent;
    while (curr && curr !== root) {
        path = curr.name + "/" + path;
        curr = curr.parent;
    }
    return path;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zb3VyY2Uvc2NlbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsZUFBZTtBQUNmLDJCQUEwQztBQUU3QixRQUFBLE9BQU8sR0FBRztJQUNuQix1QkFBdUI7SUFDdkIsaUJBQWlCO1FBQ2IsZ0JBQWdCO1FBQ2hCLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUMvQixPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDO1FBQ0QsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTVCLG1DQUFtQztRQUNuQyw4Q0FBOEM7UUFDOUMsTUFBTSxZQUFZLEdBQUcsYUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNoQixPQUFPLENBQUMsS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFDcEMsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQztRQUVELFdBQVc7UUFDWCxNQUFNLGNBQWMsR0FBRyxDQUFDLElBQVMsRUFBRSxJQUFZLEVBQU8sRUFBRTtZQUNwRCxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssSUFBSTtnQkFBRSxPQUFPLElBQUksQ0FBQztZQUNwQyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO1lBQy9CLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3ZDLE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBQ2pELElBQUksTUFB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ZWN0b3IgfSBmcm9tICdjYyc7XHJcblxyXG5leHBvcnQgY29uc3QgbWV0aG9kcyA9IHtcclxuICAgIC8qKiDojrflj5bpgInkuK3oioLngrnnmoTmiYDmnInmoIforrDlrZDoioLngrnkv6Hmga8gKi9cclxuICAgIGdldFNlbGVjdGlvbk5vZGVzKCkge1xyXG4gICAgICAgIC8vIDEuIOiOt+WPlumAieS4reeahCBVVUlEXHJcbiAgICAgICAgY29uc3QgdXVpZHMgPSBFZGl0b3IuU2VsZWN0aW9uLmdldFNlbGVjdGVkKCdub2RlJyk7XHJcbiAgICAgICAgaWYgKCF1dWlkcyB8fCB1dWlkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHRhcmdldFV1aWQgPSB1dWlkc1swXTtcclxuXHJcbiAgICAgICAgLy8gMi4g57uI5p6B5YW85a655pa55qGI77ya5LuO5b2T5YmN6L+Q6KGM55qEIGRpcmVjdG9yIOWcuuaZr+mAkuW9kuafpeaJvlxyXG4gICAgICAgIC8vIOaXoOiuuuaYr+WcqCBQcmVmYWIg5qih5byP6L+Y5piv5pmu6YCa5Zy65pmv5qih5byP77yM57yW6L6R5Zmo6YO95Lya5oqK6IqC54K55oyC5Zyo5b2T5YmNIFNjZW5lIOS4i1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRTY2VuZSA9IGRpcmVjdG9yLmdldFNjZW5lKCk7XHJcbiAgICAgICAgaWYgKCFjdXJyZW50U2NlbmUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIuOAkFVJ55Sf5oiQ5Zmo44CR5peg5rOV6I635Y+W5b2T5YmN5Zy65pmv5qC56IqC54K5XCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOWumuS5iemAkuW9kuafpeaJvuWHveaVsFxyXG4gICAgICAgIGNvbnN0IGZpbmROb2RlQnlVdWlkID0gKHJvb3Q6IGFueSwgdXVpZDogc3RyaW5nKTogYW55ID0+IHtcclxuICAgICAgICAgICAgaWYgKHJvb3QudXVpZCA9PT0gdXVpZCkgcmV0dXJuIHJvb3Q7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gcm9vdC5jaGlsZHJlbjtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZmluZE5vZGVCeVV1aWQoY2hpbGRyZW5baV0sIHV1aWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyDmiafooYzmn6Xmib5cclxuICAgICAgICBsZXQgcm9vdE5vZGUgPSBmaW5kTm9kZUJ5VXVpZChjdXJyZW50U2NlbmUsIHRhcmdldFV1aWQpO1xyXG5cclxuICAgICAgICAvLyDlpoLmnpzmib7kuI3liLDvvIzlsJ3or5UgMy44Lngg54m55pyJ55qEIGNjZSDojrflj5bmlrnlvI/vvIjkvZzkuLrlpIfpgInvvIlcclxuICAgICAgICBpZiAoIXJvb3ROb2RlKSB7XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjY2UgIT09ICd1bmRlZmluZWQnICYmIGNjZS5Ob2RlICYmIGNjZS5Ob2RlLmdldCkge1xyXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgcm9vdE5vZGUgPSBjY2UuTm9kZS5nZXQodGFyZ2V0VXVpZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghcm9vdE5vZGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIuOAkFVJ55Sf5oiQ5Zmo44CR5om+5LiN5YiwIFVVSUQg5a+55bqU55qE6IqC54K5OiBcIiArIHRhcmdldFV1aWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG5vZGVJbmZvczogYW55W10gPSBbXTtcclxuICAgICAgICBjb25zdCBwcmVmaXhNYXAgPSB7XHJcbiAgICAgICAgICAgICdfYnRuJzogJ0J1dHRvbicsXHJcbiAgICAgICAgICAgICdfbGJsJzogJ0xhYmVsJyxcclxuICAgICAgICAgICAgJ19zcHInOiAnU3ByaXRlJyxcclxuICAgICAgICAgICAgJ19ub2RlJzogJ05vZGUnLFxyXG4gICAgICAgICAgICAnX2ViJzogJ0VkaXRCb3gnXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gMy4g6YCS5b2S6YGN5Y6G6YCJ5Lit55qE5qC56IqC54K577yM5p+l5om+5qCH6K6w5a2Q6IqC54K5XHJcbiAgICAgICAgY29uc3Qgd2FsayA9IChub2RlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKCFub2RlIHx8ICFub2RlLmNoaWxkcmVuKSByZXR1cm47XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBub2RlLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBpc01hdGNoID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHByZWZpeCBpbiBwcmVmaXhNYXApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQubmFtZS5zdGFydHNXaXRoKHByZWZpeCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZUluZm9zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogY2hpbGQubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHByZWZpeE1hcFtwcmVmaXhdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZ2V0Tm9kZVBhdGgocm9vdE5vZGUsIGNoaWxkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNNYXRjaCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIOmAkuW9kue7p+e7reafpeaJvuWtkOiKgueCuVxyXG4gICAgICAgICAgICAgICAgd2FsayhjaGlsZCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHdhbGsocm9vdE5vZGUpO1xyXG4gICAgICAgIHJldHVybiB7IGNsYXNzTmFtZTogcm9vdE5vZGUubmFtZSwgbm9kZXM6IG5vZGVJbmZvcyB9O1xyXG4gICAgfVxyXG59O1xyXG5cclxuLyoqIOiuoeeul+iKgueCueebuOWvueS6juagueiKgueCueeahOi3r+W+hCAqL1xyXG5mdW5jdGlvbiBnZXROb2RlUGF0aChyb290OiBhbnksIHRhcmdldDogYW55KTogc3RyaW5nIHtcclxuICAgIGlmIChyb290ID09PSB0YXJnZXQpIHJldHVybiBcIlwiO1xyXG4gICAgbGV0IHBhdGggPSB0YXJnZXQubmFtZTtcclxuICAgIGxldCBjdXJyID0gdGFyZ2V0LnBhcmVudDtcclxuICAgIHdoaWxlIChjdXJyICYmIGN1cnIgIT09IHJvb3QpIHtcclxuICAgICAgICBwYXRoID0gY3Vyci5uYW1lICsgXCIvXCIgKyBwYXRoO1xyXG4gICAgICAgIGN1cnIgPSBjdXJyLnBhcmVudDtcclxuICAgIH1cclxuICAgIHJldHVybiBwYXRoO1xyXG59Il19